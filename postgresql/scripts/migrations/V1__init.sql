CREATE SEQUENCE organization_id_seq START WITH 1 INCREMENT BY 1;
CREATE TABLE IF NOT EXISTS organization
(
    id INTEGER PRIMARY KEY DEFAULT NEXTVAL('organization_id_seq'),
    name CHARACTER VARYING(60) NOT NULL
);

CREATE SEQUENCE IF NOT EXISTS faculty_id_seq START WITH 1 INCREMENT BY 1;
CREATE TABLE IF NOT EXISTS faculty
(
    id INTEGER PRIMARY KEY DEFAULT NEXTVAL('faculty_id_seq'),
    organization_id INTEGER NOT NULL REFERENCES organization (id) ON DELETE CASCADE ON UPDATE CASCADE,
    name CHARACTER VARYING(60) NOT NULL,
    CONSTRAINT name_identificator_combination UNIQUE (organization_id, name)
);

CREATE SEQUENCE IF NOT EXISTS program_id_seq START WITH 1 INCREMENT BY 1;
CREATE TABLE IF NOT EXISTS program
(
    id INTEGER PRIMARY KEY DEFAULT NEXTVAL('program_id_seq'),
    faculty_id INTEGER NOT NULL REFERENCES faculty (id) ON DELETE CASCADE ON UPDATE CASCADE,
    code CHARACTER VARYING(12) NOT NULL,
    name CHARACTER VARYING(60) NOT NULL
);

CREATE SEQUENCE IF NOT EXISTS profile_id_seq START WITH 1 INCREMENT BY 1;
CREATE TABLE IF NOT EXISTS profile
(
    id INTEGER PRIMARY KEY DEFAULT NEXTVAL('profile_id_seq'),
    program_id INTEGER NOT NULL REFERENCES program (id) ON DELETE CASCADE ON UPDATE CASCADE,
    name CHARACTER VARYING(60) NOT NULL
);

CREATE SEQUENCE IF NOT EXISTS teacher_id_seq START WITH 1 INCREMENT BY 1;
CREATE TABLE IF NOT EXISTS teacher
(
    id INTEGER PRIMARY KEY DEFAULT NEXTVAL('teacher_id_seq'),
    organization_teacher_id INTEGER NOT NULL
);

CREATE SEQUENCE IF NOT EXISTS discipline_id_seq START WITH 1 INCREMENT BY 1;
CREATE TABLE IF NOT EXISTS discipline
(
    id INTEGER PRIMARY KEY DEFAULT NEXTVAL('discipline_id_seq'),
    profile_id INTEGER NOT NULL REFERENCES profile (id) ON DELETE CASCADE ON UPDATE CASCADE,
    teacher_id INTEGER NOT NULL REFERENCES teacher (id) ON DELETE CASCADE ON UPDATE CASCADE,
    semester INTEGER NOT NULL,
    name CHARACTER VARYING(60) NOT NULL,
    CONSTRAINT profile_techer_semester_combination UNIQUE (profile_id, teacher_id, semester)
);

CREATE SEQUENCE IF NOT EXISTS indicator_group_id_seq START WITH 1 INCREMENT BY 1;
CREATE TABLE IF NOT EXISTS indicator_group
(
    id INTEGER PRIMARY KEY DEFAULT NEXTVAL('indicator_group_id_seq'),
    name CHARACTER VARYING(60) NOT NULL
);

CREATE SEQUENCE IF NOT EXISTS indicator_id_seq START WITH 1 INCREMENT BY 1;
CREATE TABLE IF NOT EXISTS indicator
(
    id INTEGER PRIMARY KEY DEFAULT NEXTVAL('indicator_id_seq'),
    group_id INTEGER NOT NULL REFERENCES indicator_group (id) ON DELETE CASCADE ON UPDATE CASCADE,
    discipline_id INTEGER NOT NULL REFERENCES discipline (id) ON DELETE CASCADE ON UPDATE CASCADE,
    name CHARACTER VARYING(60) NOT NULL,
    max_value INTEGER NOT NULL
);

CREATE SEQUENCE IF NOT EXISTS student_id_seq START WITH 1 INCREMENT BY 1;
CREATE TABLE IF NOT EXISTS student
(
    id INTEGER PRIMARY KEY DEFAULT NEXTVAL('student_id_seq'),
    organization_student_id INTEGER NOT NULL
);

CREATE SEQUENCE IF NOT EXISTS result_id_seq START WITH 1 INCREMENT BY 1;
CREATE TABLE IF NOT EXISTS result
(
    id INTEGER PRIMARY KEY DEFAULT NEXTVAL('result_id_seq'),
    indicator_id INTEGER NOT NULL REFERENCES indicator (id) ON DELETE CASCADE ON UPDATE CASCADE,
    student_id INTEGER NOT NULL REFERENCES student (id) ON DELETE CASCADE ON UPDATE CASCADE,
    value DOUBLE PRECISION NOT NULL,
    is_prediction BOOLEAN NOT NULL,
    CONSTRAINT student_indicator_combination UNIQUE (indicator_id, student_id)
);